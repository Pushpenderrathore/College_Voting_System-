{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h4 class="card-title mb-0">
          <i class="fas fa-users me-2"></i>Manage Users
        </h4>
        <small class="text-white-50">User accounts and voting status</small>
      </div>

      <div class="card-body">
        {% if users %}
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Voting Status</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for u in users %}
              <tr>
                <td>
                  <strong>{{ u.username }}</strong>
                  {% if u.username == session.get('username') %}
                    <span class="badge bg-light text-dark ms-1">You</span>
                  {% endif %}
                </td>

                <td>
                  {% if u.role == 'admin' %}
                    <span class="badge bg-danger">Admin</span>
                  {% else %}
                    <span class="badge bg-secondary">Voter</span>
                  {% endif %}
                </td>

                <td>
                  {% if u.voted %}
                    <span class="badge bg-success">Voted</span>
                  {% else %}
                    <span class="badge bg-warning">Not Voted</span>
                  {% endif %}
                </td>

                <td class="text-center">
                  {% if u.role != 'admin' %}
                    <button class="btn btn-sm btn-success confirm-action-btn"
                            data-action="promote"
                            data-user-id="{{ u.id }}"
                            data-username="{{ u.username }}"
                            data-csrf="{{ csrf_token() }}">
                      Promote
                    </button>
                  {% elif u.username != session.get('username') %}
                    <button class="btn btn-sm btn-warning confirm-action-btn"
                            data-action="demote"
                            data-user-id="{{ u.id }}"
                            data-username="{{ u.username }}"
                            data-csrf="{{ csrf_token() }}">
                      Demote
                    </button>
                  {% else %}
                    <span class="text-muted small">Cannot demote yourself</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- COUNTERS -->
        <div class="row text-center mt-3">
          <div class="col-md-4">
            <div class="border rounded p-2">
              <h5 class="text-danger">{{ admins }}</h5>
              <small>Admins</small>
            </div>
          </div>
          <div class="col-md-4">
            <div class="border rounded p-2">
              <h5 class="text-success">{{ voted }}</h5>
              <small>Have Voted</small>
            </div>
          </div>
          <div class="col-md-4">
            <div class="border rounded p-2">
              <h5 class="text-warning">{{ not_voted }}</h5>
              <small>Not Voted</small>
            </div>
          </div>
        </div>

        {% else %}
          <p class="text-muted">No users found.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% include 'confirm_modal.html' %}
{% endblock %}
